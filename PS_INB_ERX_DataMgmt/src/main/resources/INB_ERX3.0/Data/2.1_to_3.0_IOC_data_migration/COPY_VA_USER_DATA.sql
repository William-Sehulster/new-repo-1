--CREATES or UPDATES Production users for IOC sites
--PROMPTs for database link name e.g.(ERXD2_DBLINK.AAC.VA.GOV)
accept dblink char prompt 'Enter source database link name: '

DROP TABLE erx.va_user_tmp;

CREATE TABLE erx.va_user_tmp AS SELECT * from erx.va_user@&dblink
WHERE va_userid in (
'VHADUBALBRIC',
'VHADUBBLOUNB',
'VHADUBBROOKS4',
'VHADUBBRYAND',
'VHADUBCHRISK',
'VHADUBCLARKD2',
'VHADUBCLARKV2',
'VHADUBCOLLIS',
'VHADUBCOUNJ',
'VHADUBDUNNM',
'VHADUBEILANK',
'VHADUBHARVIB',
'VHADUBHOWARM3',
'VHADUBKAVURK',
'VHADUBLOWERS',
'VHADUBLUDWIC1',
'VHADUBMCNEEJ',
'VHADUBPROCTM',
'VHADUBPUTKOA',
'VHADUBTHIGPJ',
'VHADUBWALKEV16',
'VHABOSLEAVID',
'VHACMDLAICOQ',
'VHADURBUTTS',
'VHAHAMWANDLJ',
'VHAISADIODAL',
'VHAISARAVIKS',
'VHAISBBAYLIR',
'VHAISLSEBURC',
'VHAISPCHALLP',
'VHAISPTRIOG',
'VHAPBMCOULTD',
'VHAPBMGUERTC',
'VHAPBMLEESD',
'VHAINDNAVILC0',
'VHAINDPRYORT0',
'VHAFAVACOSTM',
'VHAFAVALLBRC',
'VHAFAVALLREC1',
'VHAFAVBARNEL',
'VHAFAVBOLTOH',
'VHAFAVBONDW',
'VHAFAVBYRDK',
'VHAFAVCHAPMA',
'VHAFAVCHILLK',
'VHAFAVCLARKM12',
'VHAFAVCOATEK',
'VHAFAVCOLEJ',
'VHAFAVCORBIN',
'VHAFAVCOSTNM',
'VHAFAVCROCKK5',
'VHAFAVDANIER',
'VHAFAVDANIET',
'VHAFAVDUNCAJ',
'VHAFAVFELKIA',
'VHAFAVGLIDEB',
'VHAFAVGRANTM',
'VHAFAVGRAYJE',
'VHAFAVHANNAK',
'VHAFAVHARPEB',
'VHAFAVHODGEB',
'VHAFAVJEANL',
'VHAFAVJOHNSR',
'VHAFAVKARLSK',
'VHAFAVKENNAS',
'VHAFAVLACKEB',
'VHAFAVLAWREA',
'VHAFAVLOGET',
'VHAFAVMILLWM',
'VHAFAVMONTGC2',
'VHAFAVNEWCOW',
'VHAFAVNEWCOW',
'VHAFAVNICHOP',
'VHAFAVOGLER',
'VHAFAVOLIVEM',
'VHAFAVPHELAS',
'VHAFAVPIELM',
'VHAFAVRABONH',
'VHAFAVRUNNEK',
'VHAFAVRUSHAM',
'VHAFAVSCHRAK',
'VHAFAVSCHUSS',
'VHAFAVSEATOV',
'VHAFAVSEDLAJ',
'VHAFAVSHEILE',
'VHAFAVSMITHT16',
'VHAFAVSONNIJ',
'VHAFAVSTARKJ1',
'VHAFAVSTEIND2',
'VHAFAVTEBBEC',
'VHAFAVTIDYMC',
'VHAFAVWAGESJ',
'VHAFAVWAGNEE',
'VHAFAVWALKEM',
'VHAFAVWALTET',
'VHAFAVWAYMAJ',
'VHAFAVWELLSL',
'VHAFAVWHITEM1',
'VHAFAVWILESR',
'VHAFAVWOOTOM');

--merging only the users from IOC sites Indianapolis, Fayettville (ARK.) and MbM Dublin. Also PBM, HPS and Maintenance team.

MERGE INTO erx.va_user target
USING (SELECT
va_userid,
first_name,
last_name,
is_pharm_mgr,
is_pbm_admn,
is_pharm_tech,
is_system_admn,
updated_date,
created_date,
updated_by,
created_by
FROM erx.va_user_tmp) s
ON (target.va_userid = s.va_userid)
WHEN MATCHED THEN
	UPDATE SET
target.first_name = s.first_name,
target.last_name = s.last_name,
target.is_pharm_mgr = s.is_pharm_mgr,
target.is_pbm_admn = s.is_pbm_admn,
target.is_pharm_user = s.is_pharm_tech,
target.is_system_admn = s.is_system_admn,
target.updated_date = s.updated_date,
target.created_date = s.created_date,
target.updated_by = s.updated_by,
target.created_by = s.created_by,
target.is_enabled = 'Y',
target.va_station_ids = 'All'
WHEN NOT MATCHED THEN
INSERT
(va_userid,
first_name,
last_name,
is_pharm_mgr,
is_pbm_admn,
is_pharm_user,
is_system_admn,
updated_date,
created_date,
updated_by,
created_by,
is_enabled,
va_station_ids)
VALUES (
s.va_userid,
s.first_name,
s.last_name,
s.is_pharm_mgr,
s.is_pbm_admn,
s.is_pharm_tech,
s.is_system_admn,
s.updated_date,
s.created_date,
s.updated_by,
s.created_by,
'Y',
'All');


UPDATE erx.va_user 
SET va_station_ids = '741DUB'
WHERE va_userid IN(
'VHACMDLAICOQ',
'VHADUBALBRIC',
'VHADUBBLOUNB',
'VHADUBBROOKS4',
'VHADUBBRYAND',
'VHADUBCHRISK',
'VHADUBCLARKD2',
'VHADUBCLARKV2',
'VHADUBCOLLIS',
'VHADUBCOUNJ',
'VHADUBDUNNM',
'VHADUBEILANK',
'VHADUBHARVIB',
'VHADUBHOWARM3',
'VHADUBKAVURK',
'VHADUBLOWERS',
'VHADUBLUDWIC1',
'VHADUBMCNEEJ',
'VHADUBPROCTM',
'VHADUBPUTKOA',
'VHADUBTHIGPJ',
'VHADUBWALKEV16');

UPDATE erx.va_user 
SET va_station_ids = '583'
WHERE va_userid IN(
'VHAINDNAVILC0',
'VHAINDPRYORT0');

UPDATE erx.va_user 
SET va_station_ids = '564'
WHERE va_userid IN(
'VHAFAVACOSTM',
'VHAFAVALLBRC',
'VHAFAVALLREC1',
'VHAFAVBARNEL',
'VHAFAVBOLTOH',
'VHAFAVBONDW',
'VHAFAVBYRDK',
'VHAFAVCHAPMA',
'VHAFAVCHILLK',
'VHAFAVCLARKM12',
'VHAFAVCOATEK',
'VHAFAVCOLEJ',
'VHAFAVCORBIN',
'VHAFAVCOSTNM',
'VHAFAVCROCKK5',
'VHAFAVDANIER',
'VHAFAVDANIET',
'VHAFAVDUNCAJ',
'VHAFAVFELKIA',
'VHAFAVGLIDEB',
'VHAFAVGRANTM',
'VHAFAVGRAYJE',
'VHAFAVHANNAK',
'VHAFAVHARPEB',
'VHAFAVHODGEB',
'VHAFAVJEANL',
'VHAFAVJOHNSR',
'VHAFAVKARLSK',
'VHAFAVKENNAS',
'VHAFAVLACKEB',
'VHAFAVLAWREA',
'VHAFAVLOGET',
'VHAFAVMILLWM',
'VHAFAVMONTGC2',
'VHAFAVNEWCOW',
'VHAFAVNEWCOW',
'VHAFAVNICHOP',
'VHAFAVOGLER',
'VHAFAVOLIVEM',
'VHAFAVPHELAS',
'VHAFAVPIELM',
'VHAFAVRABONH',
'VHAFAVRUNNEK',
'VHAFAVRUSHAM',
'VHAFAVSCHRAK',
'VHAFAVSCHUSS',
'VHAFAVSEATOV',
'VHAFAVSEDLAJ',
'VHAFAVSHEILE',
'VHAFAVSMITHT16',
'VHAFAVSONNIJ',
'VHAFAVSTARKJ1',
'VHAFAVSTEIND2',
'VHAFAVTEBBEC',
'VHAFAVTIDYMC',
'VHAFAVWAGESJ',
'VHAFAVWAGNEE',
'VHAFAVWALKEM',
'VHAFAVWALTET',
'VHAFAVWAYMAJ',
'VHAFAVWELLSL',
'VHAFAVWHITEM1',
'VHAFAVWILESR',
'VHAFAVWOOTOM');

DROP TABLE erx.va_user_tmp;